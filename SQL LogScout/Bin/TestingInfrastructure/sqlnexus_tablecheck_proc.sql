SET NOCOUNT ON
USE tempdb
GO
IF EXISTS(SELECT 1 FROM sys.procedures 
          WHERE Name = 'temp_sqlnexus')
BEGIN
    DROP PROCEDURE dbo.temp_sqlnexus
END
GO

USE tempdb
GO
CREATE PROCEDURE dbo.temp_sqlnexus
@scenarioname VARCHAR(100),@databasename SYSNAME
AS
BEGIN
SET NOCOUNT ON
-- Validate the parameter db name and scenario name
	IF (EXISTS (SELECT name FROM master.sys.databases  WHERE (name = @databasename)) and @scenarioname in ('AlwaysOn','GeneralPerf','DetailedPerf','Setup','Basic','BackupRestore','IO','LightPerf','Replication'))
	BEGIN
		IF  OBJECT_ID('tempdb..#temptablelist_sqlnexus') IS NOT NULL DROP TABLE #temptablelist_sqlnexus
		CREATE TABLE #temptablelist_sqlnexus (Id INT IDENTITY(1,1),SchemaName VARCHAR(25),TableName VARCHAR (150))
		IF (@scenarioname = 'AlwaysOn')
		BEGIN
			INSERT INTO #temptablelist_sqlnexus (SchemaName,TableName) VALUES
			('dbo','tbl_Reports'),
			('dbo','tbl_trace_event_details'),
			('dbo','tblDefaultConfigures'),
			('dbo','tblObjectsUsedByTopPlans'),
			('dbo','tbl_AnalysisSummary'),
			('dbo','tblNexusInfo'),
			('dbo','tbl_hadr_endpoints_principals'),
			('dbo','tbl_hadr_mirroring_endpoints_permissions'),
			('dbo','tbl_hadr_mirroring_states'),
			('dbo','tbl_hadr_ag_listeners'),
			('dbo','tbl_hadr_ag_ip_information'),
			('dbo','tbl_hadr_readonly_routing'),
			('dbo','tbl_hadr_cluster'),
			('dbo','tbl_hadr_cluster_members'),
			('dbo','tbl_hadr_ag_states'),
			('dbo','tbl_hadr_ag_replica_states'),
			('dbo','tbl_hadr_dm_os_server_diagnostics_log_configurations'),
			('dbo','tbl_hadr_alwayson_health_alwayson_ddl_executed'),
			('dbo','tbl_hadr_alwayson_health_failovers'),
			('dbo','tbl_hadr_alwayson_health_availability_replica_manager_state_change'),
			('dbo','tbl_hadr_alwayson_health_availability_replica_state_change'),
			('dbo','tbl_hadr_alwayson_health_availability_group_lease_expired'),
			('ReadTrace','tblUniqueBatches'),
			('ReadTrace','tblUniqueStatements'),
			('ReadTrace','tblUniquePlans'),
			('ReadTrace','tblUniquePlanRows'),
			('ReadTrace','tblBatches'),
			('ReadTrace','tblStatements'),
			('ReadTrace','tblPlans'),
			('ReadTrace','tblPlanRows'),
			('ReadTrace','tblInterestingEvents'),
			('ReadTrace','tblConnections'),
			('ReadTrace','tblTimeIntervals'),
			('ReadTrace','tblTraceFiles'),
			('ReadTrace','tblTracedEvents'),
			('ReadTrace','tblBatchPartialAggs'),
			('dbo','Counters'),
			('ReadTrace','tblComparisonBatchPartialAggs'),
			('ReadTrace','tblStmtPartialAggs'),
			('ReadTrace','tblWarnings'),
			('ReadTrace','tblMiscInfo'),
			('ReadTrace','tblProcedureNames'),
			('ReadTrace','tblUniqueAppNames'),
			('ReadTrace','tblUniqueLoginNames'),
			('dbo','CounterDetails'),
			('dbo','CounterData'),
			('dbo','DisplayToID'),
			('dbo','tblTopSqlPlan'),
			('dbo','tbl_HEADBLOCKERSUMMARY'),
			('dbo','tbl_NOTABLEACTIVEQUERIES'),
			('dbo','tbl_REQUESTS'),
			('dbo','tbl_OS_WAIT_STATS'),
			('dbo','tbl_SYSPERFINFO'),
			('dbo','tbl_SQL_CPU_HEALTH'),
			('dbo','tbl_FILE_STATS'),
			('dbo','tbl_SYSINFO'),
			('dbo','tbl_PERF_STATS_SCRIPT_RUNTIMES'),
			('dbo','tbl_BLOCKING_CHAINS')		
		END
		ELSE IF ((@scenarioname = 'GeneralPerf') Or (@scenarioname = 'DetailedPerf'))
		BEGIN
			INSERT INTO #temptablelist_sqlnexus (SchemaName,TableName) VALUES
			('dbo','CounterDetails'),
			('dbo','CounterData'),
			('dbo','DisplayToID'),
			('dbo','tblNexusInfo'),
			('dbo','tblTopSqlPlan'),
			('dbo','tbl_profiler_trace_summary'),
			('dbo','tbl_profiler_trace_event_details'),
			('dbo','tbl_XEvents'),
			('dbo','tbl_HEADBLOCKERSUMMARY'),
			('dbo','tbl_RUNTIMES'),
			('dbo','tbl_NOTABLEACTIVEQUERIES'),
			('dbo','tbl_IMPORTEDFILES'),
			('dbo','tbl_REQUESTS'),
			('dbo','tbl_SCRIPT_ENVIRONMENT_DETAILS'),
			('dbo','tbl_FILE_STATS'),
			('dbo','tbl_OS_WAIT_STATS'),
			('dbo','tbl_SYSINFO'),
			('dbo','tbl_SPINLOCKSTATS'),
			('dbo','tbl_SYSPERFINFO'),
			('dbo','tbl_SQL_CPU_HEALTH'),
			('dbo','tbl_dm_os_sys_info'),
			('dbo','tbl_PERF_STATS_SCRIPT_RUNTIMES'),
			('dbo','tbl_dm_os_latch_stats'),
			('dbo','tbl_FileStats'),
			('dbo','tbl_dm_exec_query_resource_semaphores'),
			('dbo','tbl_dm_exec_query_memory_grants'),
			('dbo','tbl_BLOCKING_CHAINS'),
			('dbo','tbl_dm_os_memory_brokers'),
			('dbo','tbl_dm_os_nodes'),
			('dbo','tbl_dm_os_memory_nodes'),
			('dbo','tbl_LockSummary'),
			('dbo','tbl_ThreadStats'),
			('dbo','tbl_dm_db_file_space_usage'),
			('dbo','tbl_dm_exec_cursors'),
			('dbo','tbl_dm_os_ring_buffers_conn'),
			('dbo','tbl_PlanCache_Stats'),
			('dbo','tbl_System_Requests'),
			('dbo','tbl_Query_Execution_Memory'),
			('dbo','tbl_TopN_QueryPlanStats'),
			('dbo','tbl_MissingIndexes'),
			('dbo','tbl_database_options'),
			('dbo','tbl_db_TDE_Info'),
			('dbo','tbl_dm_os_loaded_modules'),
			('dbo','tbl_server_audit_status'),
			('dbo','tbl_Reports'),
			('dbo','tbl_Top10_CPU_Consuming_Procedures'),
			('dbo','tbl_Top10_CPU_Consuming_Triggers'),
			('dbo','tbl_dm_db_stats_properties'),
			('dbo','tbl_DisabledIndexes'),
			('dbo','tbl_server_times'),
			('dbo','tbl_resource_governor_configuration'),
			('dbo','tbl_resource_governor_resource_pools'),
			('dbo','tbl_resource_governor_workload_groups'),
			('dbo','tbl_trace_event_details'),			
			('dbo','tblDefaultConfigures'),
			('dbo','tbl_Hist_Top10_CPU_Queries_by_Planhash_and_Queryhash'),
			('dbo','tbl_Hist_Top10_CPU_Queries_ByQueryHash'),
			('dbo','tbl_Hist_Top10_ElapsedTime_Queries_by_Planhash_and_Queryhash'),
			('dbo','tbl_Hist_Top10_ElapsedTime_Queries_ByQueryHash'),			
			('dbo','tbl_Hist_Top10_LogicalReads_Queries_by_Planhash_and_Queryhash'),			
			('dbo','tbl_Hist_Top10_LogicalReads_Queries_ByQueryHash'),			
			('dbo','tblObjectsUsedByTopPlans'),
			('dbo','tbl_AnalysisSummary'),
			('dbo','tbl_database_scoped_configurations'),
			('dbo','tbl_dm_db_file_space_usage_summary'),
			('dbo','tbl_tempdb_space_usage_by_file'),
			('dbo','tbl_transaction_perfmon_counters'),
			('dbo','tbl_dm_db_session_space_usage'),
			('dbo','tbl_dm_db_task_space_usage'),
			('dbo','tbl_version_store_transactions'),
			('dbo','tbl_open_transactions'),
			('dbo','tbl_tempdb_usage_by_object'),
			('dbo','tbl_tempdb_waits'),
			('dbo','tbl_ActiveServices_OS'),
			('dbo','tbl_ActiveProcesses_OS'),
			('dbo','tbl_fltmc_filters'),
			('dbo','tbl_fltmc_instances'),
			('dbo','tbl_DiagInfo'),
			('dbo','tbl_ServerProperties'),
			('dbo','tbl_StartupParameters'),
			('dbo','tbl_TraceFlags'),
			('dbo','tbl_dm_os_schedulers_snapshot'),
			('dbo','tbl_dm_os_sys_info_miscpssdiaginfo'),
			('dbo','tbl_Sys_Configurations'),
			('dbo','tbl_DatabaseFiles'),
			('dbo','tbl_SysDatabases'),
			('dbo','Counters'),
			('ReadTrace','tblUniqueBatches'),
			('ReadTrace','tblUniqueStatements'),
			('ReadTrace','tblUniquePlans'),
			('ReadTrace','tblUniquePlanRows'),
			('ReadTrace','tblBatches'),
			('ReadTrace','tblStatements'),
			('ReadTrace','tblPlans'),
			('ReadTrace','tblPlanRows'),
			('ReadTrace','tblInterestingEvents'),
			('ReadTrace','tblConnections'),
			('ReadTrace','tblTimeIntervals'),
			('ReadTrace','tblTraceFiles'),
			('ReadTrace','tblTracedEvents'),
			('ReadTrace','tblBatchPartialAggs'),
			('ReadTrace','tblComparisonBatchPartialAggs'),
			('ReadTrace','tblStmtPartialAggs'),
			('ReadTrace','tblWarnings'),
			('ReadTrace','tblMiscInfo'),
			('ReadTrace','tblProcedureNames'),
			('ReadTrace','tblUniqueAppNames'),
			('ReadTrace','tblUniqueLoginNames')
		END
		ELSE IF ((@scenarioname = 'Setup') Or (@scenarioname = 'Basic'))
		BEGIN
			INSERT INTO #temptablelist_sqlnexus (SchemaName,TableName) VALUES
			('dbo','tblNexusInfo'),
			('dbo','tbl_ActiveServices_OS'),
			('dbo','tbl_ActiveProcesses_OS'),
			('dbo','tbl_fltmc_filters'),
			('dbo','tbl_fltmc_instances'),
			('dbo','tbl_DiagInfo'),
			('dbo','tbl_SCRIPT_ENVIRONMENT_DETAILS'),
			('dbo','tbl_ServerProperties'),
			('dbo','tbl_StartupParameters'),
			('dbo','tbl_TraceFlags'),
			('dbo','tbl_dm_os_schedulers_snapshot'),
			('dbo','tbl_dm_os_sys_info_miscpssdiaginfo'),
			('dbo','tbl_Sys_Configurations'),
			('dbo','tbl_DatabaseFiles'),
			('dbo','tbl_SysDatabases'),
			('dbo','tbl_profiler_trace_summary'),
			('dbo','tbl_profiler_trace_event_details'),
			('dbo','tbl_XEvents'),
			('dbo','tblTopSqlPlan'),
			('dbo','tbl_HEADBLOCKERSUMMARY'),
			('dbo','tbl_NOTABLEACTIVEQUERIES'),
			('dbo','tbl_REQUESTS'),
			('dbo','tbl_OS_WAIT_STATS'),
			('dbo','tbl_SYSPERFINFO'),
			('dbo','tbl_SQL_CPU_HEALTH'),
			('dbo','tbl_FILE_STATS'),
			('dbo','tbl_SYSINFO'),
			('dbo','tbl_PERF_STATS_SCRIPT_RUNTIMES'),
			('dbo','tbl_BLOCKING_CHAINS'),
			('dbo','tbl_Reports'),
			('dbo','tbl_trace_event_details'),
			('dbo','tblDefaultConfigures'),
			('dbo','tblObjectsUsedByTopPlans'),
			('dbo','tbl_AnalysisSummary')
		END
		ELSE IF (@scenarioname = 'BackupRestore')
		BEGIN
			INSERT INTO #temptablelist_sqlnexus (SchemaName,TableName) VALUES
			('dbo','CounterDetails'),
			('dbo','CounterData'),
			('dbo','DisplayToID'),
			('dbo','tblNexusInfo'),
			('dbo','tbl_ActiveServices_OS'),
			('dbo','tbl_ActiveProcesses_OS'),
			('dbo','tbl_fltmc_filters'),
			('dbo','tbl_fltmc_instances'),
			('dbo','tbl_DiagInfo'),
			('dbo','tbl_SCRIPT_ENVIRONMENT_DETAILS'),
			('dbo','tbl_ServerProperties'),
			('dbo','tbl_StartupParameters'),
			('dbo','tbl_TraceFlags'),
			('dbo','tbl_dm_os_schedulers_snapshot'),
			('dbo','tbl_dm_os_sys_info_miscpssdiaginfo'),
			('dbo','tbl_Sys_Configurations'),
			('dbo','tbl_DatabaseFiles'),
			('dbo','tbl_SysDatabases'),
			('dbo','tbl_profiler_trace_summary'),
			('dbo','tbl_profiler_trace_event_details'),
			('dbo','tbl_XEvents'),
			('ReadTrace','tblUniqueBatches'),
			('ReadTrace','tblUniqueStatements'),
			('ReadTrace','tblUniquePlans'),
			('ReadTrace','tblUniquePlanRows'),
			('ReadTrace','tblBatches'),
			('ReadTrace','tblStatements'),
			('ReadTrace','tblPlans'),
			('ReadTrace','tblPlanRows'),
			('ReadTrace','tblInterestingEvents'),
			('ReadTrace','tblConnections'),
			('ReadTrace','tblTimeIntervals'),
			('ReadTrace','tblTraceFiles'),
			('ReadTrace','tblTracedEvents'),
			('ReadTrace','tblBatchPartialAggs'),
			('ReadTrace','tblComparisonBatchPartialAggs'),
			('ReadTrace','tblStmtPartialAggs'),
			('ReadTrace','tblWarnings'),
			('ReadTrace','tblMiscInfo'),
			('ReadTrace','tblProcedureNames'),
			('ReadTrace','tblUniqueAppNames'),
			('ReadTrace','tblUniqueLoginNames')
		END
		ELSE IF (@scenarioname = 'IO')
		BEGIN
			INSERT INTO #temptablelist_sqlnexus (SchemaName,TableName) VALUES
			('dbo','Counters'),
			('dbo','tblNexusInfo'),
			('dbo','tbl_ActiveServices_OS'),
			('dbo','tbl_ActiveProcesses_OS'),
			('dbo','tbl_fltmc_filters'),
			('dbo','tbl_fltmc_instances'),
			('dbo','tbl_DiagInfo'),
			('dbo','tbl_SCRIPT_ENVIRONMENT_DETAILS'),
			('dbo','tbl_ServerProperties'),
			('dbo','tbl_StartupParameters'),
			('dbo','tbl_TraceFlags'),
			('dbo','tbl_dm_os_schedulers_snapshot'),
			('dbo','tbl_dm_os_sys_info_miscpssdiaginfo'),
			('dbo','tbl_Sys_Configurations'),
			('dbo','tbl_DatabaseFiles'),
			('dbo','tbl_SysDatabases'),
			('dbo','tbl_profiler_trace_summary'),
			('dbo','tbl_profiler_trace_event_details'),
			('dbo','tbl_XEvents'),
			('dbo','CounterDetails'),
			('dbo','CounterData'),
			('dbo','DisplayToID'),
			('dbo','tblTopSqlPlan'),
			('dbo','tbl_HEADBLOCKERSUMMARY'),
			('dbo','tbl_NOTABLEACTIVEQUERIES'),
			('dbo','tbl_REQUESTS'),
			('dbo','tbl_OS_WAIT_STATS'),
			('dbo','tbl_SYSPERFINFO'),
			('dbo','tbl_SQL_CPU_HEALTH'),
			('dbo','tbl_FILE_STATS'),
			('dbo','tbl_SYSINFO'),
			('dbo','tbl_PERF_STATS_SCRIPT_RUNTIMES'),
			('dbo','tbl_BLOCKING_CHAINS'),
			('dbo','tbl_Reports'),
			('dbo','tbl_trace_event_details'),
			('dbo','tblDefaultConfigures'),
			('dbo','tblObjectsUsedByTopPlans'),
			('dbo','tbl_AnalysisSummary')
		END
		ELSE IF (@scenarioname = 'LightPerf')
		BEGIN
			INSERT INTO #temptablelist_sqlnexus (SchemaName,TableName) VALUES
			('dbo','tbl_Reports'),
			('dbo','tbl_trace_event_details'),
			('dbo','tblDefaultConfigures'),
			('dbo','tblObjectsUsedByTopPlans'),
			('dbo','tbl_AnalysisSummary'),
			('dbo','tblNexusInfo'),
			('dbo','tbl_profiler_trace_summary'),
			('dbo','tbl_profiler_trace_event_details'),
			('dbo','tbl_XEvents'),
			('dbo','tbl_RUNTIMES'),
			('dbo','tbl_IMPORTEDFILES'),
			('dbo','tbl_SCRIPT_ENVIRONMENT_DETAILS'),
			('dbo','tbl_OS_WAIT_STATS'),
			('dbo','tbl_SPINLOCKSTATS'),
			('dbo','tbl_SYSPERFINFO'),
			('dbo','tbl_SQL_CPU_HEALTH'),
			('dbo','tbl_dm_os_sys_info'),
			('dbo','tbl_dm_os_latch_stats'),
			('dbo','tbl_FileStats'),
			('dbo','tbl_dm_exec_query_resource_semaphores'),
			('dbo','tbl_dm_exec_query_memory_grants'),
			('dbo','tbl_dm_os_memory_brokers'),
			('dbo','tbl_dm_os_nodes'),
			('dbo','tbl_dm_os_memory_nodes'),
			('dbo','tbl_LockSummary'),
			('dbo','tbl_ThreadStats'),
			('dbo','tbl_dm_db_file_space_usage'),
			('dbo','tbl_dm_exec_cursors'),
			('dbo','tbl_dm_os_ring_buffers_conn'),
			('dbo','tbl_PlanCache_Stats'),
			('dbo','tbl_System_Requests'),
			('dbo','tbl_Query_Execution_Memory'),
			('dbo','tbl_TopN_QueryPlanStats'),
			('dbo','tbl_MissingIndexes'),
			('dbo','tbl_database_options'),
			('dbo','tbl_db_TDE_Info'),
			('dbo','Counters'),
			('dbo','tbl_dm_os_loaded_modules'),
			('dbo','tbl_server_audit_status'),
			('dbo','tbl_Top10_CPU_Consuming_Procedures'),
			('dbo','tbl_Top10_CPU_Consuming_Triggers'),
			('dbo','tbl_dm_db_stats_properties'),
			('dbo','tbl_DisabledIndexes'),
			('dbo','tbl_server_times'),
			('dbo','tbl_resource_governor_configuration'),
			('dbo','tbl_resource_governor_resource_pools'),
			('dbo','tbl_resource_governor_workload_groups'),
			('dbo','tbl_Hist_Top10_CPU_Queries_ByQueryHash'),
			('dbo','tbl_Hist_Top10_LogicalReads_Queries_ByQueryHash'),
			('dbo','tbl_Hist_Top10_ElapsedTime_Queries_ByQueryHash'),
			('dbo','tbl_Hist_Top10_CPU_Queries_by_Planhash_and_Queryhash'),
			('dbo','tbl_Hist_Top10_LogicalReads_Queries_by_Planhash_and_Queryhash'),
			('dbo','tbl_Hist_Top10_ElapsedTime_Queries_by_Planhash_and_Queryhash'),
			('dbo','tbl_database_scoped_configurations'),
			('dbo','tbl_dm_db_file_space_usage_summary'),
			('dbo','tbl_tempdb_space_usage_by_file'),
			('dbo','tbl_transaction_perfmon_counters'),
			('dbo','tbl_dm_db_session_space_usage'),
			('dbo','tbl_dm_db_task_space_usage'),
			('dbo','tbl_version_store_transactions'),
			('dbo','tbl_open_transactions'),
			('dbo','tbl_tempdb_usage_by_object'),
			('dbo','tbl_tempdb_waits'),
			('dbo','tbl_ActiveServices_OS'),
			('dbo','tbl_ActiveProcesses_OS'),
			('dbo','tbl_fltmc_filters'),
			('dbo','tbl_fltmc_instances'),
			('dbo','tbl_DiagInfo'),
			('dbo','tbl_ServerProperties'),
			('dbo','tbl_StartupParameters'),
			('dbo','tbl_TraceFlags'),
			('dbo','tbl_dm_os_schedulers_snapshot'),
			('dbo','tbl_dm_os_sys_info_miscpssdiaginfo'),
			('dbo','tbl_Sys_Configurations'),
			('dbo','tbl_DatabaseFiles'),
			('dbo','tbl_SysDatabases'),
			('dbo','CounterDetails'),
			('dbo','CounterData'),
			('dbo','DisplayToID'),
			('dbo','tblTopSqlPlan'),
			('dbo','tbl_HEADBLOCKERSUMMARY'),
			('dbo','tbl_NOTABLEACTIVEQUERIES'),
			('dbo','tbl_REQUESTS'),
			('dbo','tbl_FILE_STATS'),
			('dbo','tbl_SYSINFO'),
			('dbo','tbl_PERF_STATS_SCRIPT_RUNTIMES'),
			('dbo','tbl_BLOCKING_CHAINS')
		END

		ELSE IF (@scenarioname = 'Replication')
		BEGIN
			INSERT INTO #temptablelist_sqlnexus (SchemaName,TableName) VALUES
			('dbo','tbl_trace_event_details'),
			('dbo','tblDefaultConfigures'),
			('dbo','tblObjectsUsedByTopPlans'),
			('dbo','tbl_AnalysisSummary'),
			('dbo','tblNexusInfo'),
			('dbo','tbl_ActiveServices_OS'),
			('dbo','tbl_ActiveProcesses_OS'),
			('dbo','tbl_fltmc_filters'),
			('dbo','tbl_fltmc_instances'),
			('dbo','tbl_DiagInfo'),
			('dbo','tbl_SCRIPT_ENVIRONMENT_DETAILS'),
			('dbo','tbl_ServerProperties'),
			('dbo','tbl_StartupParameters'),
			('dbo','tbl_TraceFlags'),
			('dbo','tbl_dm_os_schedulers_snapshot'),
			('dbo','tbl_dm_os_sys_info_miscpssdiaginfo'),
			('dbo','tbl_Sys_Configurations'),
			('dbo','tbl_DatabaseFiles'),
			('dbo','tbl_SysDatabases'),
			('dbo','tbl_profiler_trace_summary'),
			('dbo','tbl_profiler_trace_event_details'),
			('dbo','tbl_XEvents'),
			('dbo','tbl_repl_sourceserver'),
			('dbo','tbl_repl_msdb_jobs'),
			('dbo','tbl_repl_msarticles'),
			('dbo','tbl_repl_mscached_peer_lsns'),
			('dbo','tbl_repl_msdistribution_agents'),
			('dbo','tbl_repl_msdistribution_history'),
			('dbo','tbl_repl_mslogreader_agents'),
			('dbo','tbl_repl_mslogreader_history'),
			('dbo','tbl_repl_msmerge_agents'),
			('dbo','tbl_repl_msmerge_history'),
			('dbo','tbl_repl_msmerge_identity_range_allocations'),
			('dbo','tbl_repl_msmerge_sessions'),
			('dbo','tbl_repl_msmerge_subscriptions'),
			('dbo','tbl_repl_mspublication_access'),
			('dbo','tbl_repl_mspublications'),
			('dbo','tbl_repl_mspublicationthresholds'),
			('dbo','tbl_repl_mspublisher_databases'),
			('dbo','tbl_repl_msqreader_agents'),
			('dbo','tbl_repl_msrepl_backup_lsns'),
			('dbo','tbl_repl_msrepl_commands_oldest'),
			('dbo','tbl_repl_msrepl_commands_newest'),
			('dbo','tbl_repl_msrepl_errors'),
			('dbo','tbl_repl_msrepl_identity_range'),
			('dbo','tbl_repl_msrepl_originators'),
			('dbo','tbl_repl_msrepl_transactions_oldest'),
			('dbo','tbl_repl_msrepl_transactions_newest'),
			('dbo','tbl_repl_msrepl_version'),
			('dbo','tbl_repl_msreplication_monitordata'),
			('dbo','tbl_repl_mssnapshot_agents'),
			('dbo','tbl_repl_mssnapshot_history'),
			('dbo','tbl_repl_mssubscriber_info'),
			('dbo','tbl_repl_mssubscriber_schedule'),
			('dbo','tbl_repl_mssubscriptions'),
			('dbo','tbl_repl_mssync_states'),
			('dbo','tbl_repl_mstracer_history'),
			('dbo','tbl_repl_mstracer_tokens'),
			('dbo','tbl_repl_sysservers'),
			('dbo','tblTopSqlPlan'),
			('dbo','tbl_HEADBLOCKERSUMMARY'),
			('dbo','tbl_NOTABLEACTIVEQUERIES'),
			('dbo','tbl_REQUESTS'),
			('dbo','tbl_OS_WAIT_STATS'),
			('dbo','tbl_SYSPERFINFO'),
			('dbo','tbl_SQL_CPU_HEALTH'),
			('dbo','tbl_FILE_STATS'),
			('dbo','tbl_SYSINFO'),
			('dbo','tbl_PERF_STATS_SCRIPT_RUNTIMES'),
			('dbo','tbl_BLOCKING_CHAINS'),
			('dbo','tbl_Reports')
		END
		
		Exec('SELECT '''+ @databasename+''' DBName ,t1.SchemaName, t1.TableName , ''No'' Present 
		FROM #temptablelist_sqlnexus t1 LEFT OUTER JOIN '+ @databasename+'.INFORMATION_SCHEMA.TABLES t2
			ON t1.tablename = t2.TABLE_NAME and t1.SchemaName = t2.TABLE_SCHEMA 
		WHERE t2.TABLE_NAME IS NULL AND t2.TABLE_SCHEMA IS NULL 
		ORDER BY t1.TableName')
		
		IF (@@ROWCOUNT > 0)
		BEGIN
		    SELECT ' '
			SELECT 202 AS EXIT_CODE
		END
	END
END

--exec tempdb..temp_sqlnexus 'LightPerf','sqlnexus'
